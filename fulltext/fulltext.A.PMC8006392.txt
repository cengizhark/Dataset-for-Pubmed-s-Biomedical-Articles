I.
INTRODUCTION
Regenerative medicine aims to produce fully functional tissue for implantation, often in an ex vivo setting, for purposes of replacing or regenerating organs. A common TE protocol is to seed cells into predetermined tissue scaffolds, adjust the physical conditions such as flow rate, nutrients, and growth factors, and then, measure cell response. In recent years, the role of mechanical forces, such as shear stress, has been recognized in the context of regulating proliferation, migration and morphogenesis [1]-[6]. Consequently, considerable efforts have been devoted to tailoring shear stress distributions arising from flow fields applied to bioreactors as a means to study the cellular response due to spatial gradients [7]-[11]. The state of the art approach involves creating materials with local porosity gradients [8], [9], [12]-[17]. While this is suitable for setting initial conditions in a scaffold at the expense of high material complexity, it fails to accommodate the dynamical aspect where different stages of development lead to changes in material properties.
It is thus important to develop novel methods that achieve viable growth of thick, immunocompatible tissue. In this paper, we present the engineering aspects of a general methodology tailored to spatiotemporally control mechanical forces inside bioreactors. Advantages of our method include the creation of complex flow fields in 3-D environments and the possibility of real-time control in response to cell growth without altering the composition or structure of the scaffold material itself. With the temporal aspect included as the fourth dimension, we refer to the method as 4-D flow control. Our approach can be also used in conjunction with existing methods to enhance their capabilities and add the time component to extend control beyond the initial stages. By adjusting inlet pressures to a multiple-inlet bioreactor, we can produce arbitrary flow fields to generate various mechanical force distributions within a single scaffold. Real-time control can be achieved by employing this flow control strategy as part of a feedback control loop that is guided by noninvasive imaging. The spatial distribution of mechanical forces can be altered on demand by dialing-in the appropriate inlet pressure at various inlets, thereby offering flexible means of dynamic control that can adapt to structural changes.
The design and construction of a ten-inlet bioreactor is shown in Fig. 1. The bioreactor is made of nonmagnetic material for compatibility with a nuclear magnetic resonance (NMR) environment where maps of fluid velocity inside the reactor are measured [18]. From the flow maps, we calculate the shear rate distributions using finite-difference approximations [19]. This provides an estimate of interstitial flows in the porous scaffold matrix. NMR was selected as the method to assess material properties because of its ability to probe opaque media in a noninvasive manner. Namely, it can be used for investigating the hydrodynamic properties of biomaterials through noninvasive measurements of shear rate, hydraulic pressure, and fluid permeability, as demonstrated in recent studies [19], [20].
Our approach operates in two phases, a training phase and an adaptive feedback phase. The first phase involves training a multilayer perceptron (MLP) to learn the nonlinear relationship between flows applied at the bioreactor’s inlets and the shear rate maps resulting in the scaffold. In order to reduce the need for experimental measurements, the MLP is trained with examples obtained from computational fluid dynamics (CFD) simulations that estimate patterns of flow and shear rate based on known material properties, namely fluid permeability and porosity [9], [21]. During this phase, a set of inlet flow speeds is found that can be dialed-in to produce a desired shear rate distribution within a scaffold. The second phase is where the trained system is applied to adaptively control flow fields in the actual scaffold. Here, noninvasive NMR velocimetry measurements are used to determine flow velocities and shear rate distribution in the scaffold. These measurements can be used to provide feedback for adaptive fine tuning or adjustment of the shear rate maps in the scaffold.
II.
MATERIALS AND METHODS
A.Ten-Channel Bioreactor DesignA bioreactor featuring ten input channels and one output channel was designed to demonstrate our method, as shown in Fig. 1. Inlets are distributed around a chamber that holds a 3-mm-thick scaffold. There are three inlets at a 45° angle on each side, four inlets at the bottom, and one output channel at the top. Fig. 1(a) and (b) show the CAD drawings of the bioreactor design. Fig. 1(c) and (d) show the actual bioreactor, and Fig. 1(e) shows the fully assembled bioreactor. The bioreactor and its parts were made of NMR-compatible materials such as PTFE. The bioreactor is designed to fit in a 40-mm-i.d. NMR imaging probe. Inlets are connected to current-controlled mini proportional valves (Kelly Pneumatics, Inc., Costa Mesa, CA, USA). A programmable current regulating circuit was designed to receive commands from a computer program to set the current value at each valve. This enabled computer controlled flow speeds at each inlet.
B.ScaffoldTwo different scaffolds were used in these experiments. The first scaffold, a high porosity, high permeability cellulose scaffold was used to demonstrate the ability to generate various flow patterns. No cells were present in this scaffold. The second scaffold was a high porosity, high permeability biocompatible collagen scaffold (Ultrafoam, Central Infusion Alliance 1050020). The collagen scaffold was used for cell experiments to test the biocompatibility of the system and demonstrate the ability to grow cells. Scaffolds were cut into blocks of size 1.25 cm × 1.25 cm × 0.3 cm. In Fig. 1(h), scanning electron microscopy (SEM) micrographs (JEOL JSM-6700) reveal pore size and morphology of the scaffolds. Prior to SEM, scaffold samples were sputter coated with a ~5-nm layer of gold to enhance contrast and reduce sample charging. Porosity was calculated to be approximately 90% for the cellulose scaffold and 93% for the collagen scaffold. Porosity was determined by measuring the water volume absorbed by the scaffold, and dividing it by the total volume of the wet scaffold. To accurately determine the volumes, a replica of the bioreactor chamber, i.e., the region that holds the scaffold inside the bioreactor, was created in a plastic block. The weight of the empty chamber with the dry scaffold was measured using a precision balance. The scaffold was then submerged in water and placed in the chamber and the chamber was filled with water to the fullest. The chamber was then closed tightly allowing excess water to exit. The chamber containing the hydrated scaffold was weighed. Water volume was determined by subtracting the weight of the chamber with the dry scaffold from the weight of the chamber with the hydrated scaffold inside. The volume of the hydrated scaffold is the same as the chamber volume, which is easily calculated from the known inner chamber dimensions. This gives a consistent measurement of the effective porosity corresponding to the wet scaffold inside the chamber, where swelling of the scaffold becomes irrelevant.Fluid permeability of the scaffolds was measured in a fluid permeability flow chamber with a 1-cm diameter cross-sectional area [19]. Scaffolds being measured were cut into disks 10.1 mm in diameter and 5.3-mm thick prior to wetting. Scaffold thickness and diameter were measured with WorkZone Digital Caliper with a range of 0–200 mm. Scaffolds were held in place by two large pore-density filters. Known flow rates were then applied ranging from 5 to 60 mL/min. The static pressures entering and exiting the flow chamber were also measured. The pressure drop across the scaffold was found by subtracting the pressure drop across the chamber without the scaffold from the pressure drop across the chamber with the scaffold. Pressure was measured using Omega DPG8000 pressure gauges. Two units were mounted to the flow path using pipe T connectors, and digital readouts were obtained from the device and recorded once the pressure had stabilized. The permeabilities at each flow rate were then averaged to give a final permeability. Using this information, fluid permeability was determined from Darcy’s law
(1)κ=−μLQAΔP
where κ is the fluid permeability, μ is the viscosity, L is the scaffold thickness, Q is the flow rate, A is the surface area, and ΔP is the pressure drop across the scaffold. The calculated permeabilities were 6.13 × 10−7 cm2 and 2 × 10−11 cm2 for the cellulose and collagen scaffolds, respectively.
C.Adaptive Control AlgorithmMachine learning methods including artificial neural networks are now commonly used to solve a variety of problems in cell biology [22], [23]. We present a novel multiple-input, multiple-output (MIMO) adaptive intelligent control algorithm based on an MLP. Our algorithm consists of a fast search method designed to guide an MLP to perform an initial estimation of required inlet speeds using CFD simulations, by learning the nonlinear relationship between inlet flow speeds and target parameters. The scaffold was treated as a grid with nine equal regions. The algorithm was configured to create shear rate patterns by simultaneously controlling shear rate mean values in these regions. Thus, the problem in our case involves ten inlets and nine parameters. Parameter values can be adjusted depending on the application requirements. For example, while a 3×3 grid is sufficient in our case for demonstration purposes, higher resolution can be achieved with more computational time. In other applications, the grid can also be concentrated on one small local region rather than the entire scaffold.The working principle of the algorithm is illustrated in Fig. 2(d). The pseudocode is provided in Algorithm 1, whereas its parameters are listed in Table I. The search algorithm starts with a target shear rate map specified by the user. Mean values from different regions of the map are fed to an MLP as its input, and the output produced by the MLP is used to determine the flow speeds of all ten inlets required to reproduce the desired target map as closely as possible. A new shear rate map corresponding to the inlets’ flow speeds generated by the MLP with D inputs is obtained (Oj) and compared to the desired target (Tj) pattern using the cost function ξ1 of
(2)(ξ1)2=∑j=1D(Tj−Tje−(Oj−Tj)22d2Tj)2=∑j=1D(1−e−(Oj−Tj)22d2)2.In principle, one could employ a cost function that simply measures the Euclidean distance between a given vector and a target vector as
(3)(ξ2)2=∑j=1D(Oj−Tj)2.However, including a Gaussian membership function, as was the case in (2) can relax the measurement constraints by allowing a small margin of error where an approximate measurement is considered acceptable. d determines the width of the Gaussian function. Using a d value close to the average target value “smoothes” the error space, which leads to faster convergence. To prevent the search algorithm from biasing toward relatively large target vector components, a normalization is performed by dividing by the target vector, as shown in (2).For example, a target shear rate map can have high variations in shear rate values between different regions. Regions with relatively high shear rate values will carry more weight in the cost function. This can cause the obtained solution to be less accurate in regions with relatively low shear rate values. Normalizing as in (2) allows each region to contribute an equal weight to the cost function regardless of the target value in that region. When the values of Oj and Tj are close to each other, the Gaussian function yields a value close to one, and the contribution of the corresponding measurement to the cost function is small. When the values of Oj and Tj are far apart, the Gaussian function yields a value close to zero, and the contribution to the cost function is large. Oj denotes a measurement (observed value), whereas Tj denotes the corresponding desired measurement (target value). By measurement, we refer to a mean shear rate value associated with one of the scaffold regions.The initial MLP output does not yield the most accurate solution. The search algorithm aims to find a solution that is better than the one provided by the MLP, by following a number of rules to introduce changes to the MLP output as shown in the pseudocode below (see Algorithm 1). The new solution is used to update the MLP weights as explained in the following section. This guides the MLP to gradually learn the relationship between the inlets’ flow speeds and the target map after a number of iterations. The algorithm was validated by applying it to a two-input control problem where the convergence path through the error space can be visualized on a 3-D plot. Results from the validation are shown in Fig. 2(a)-(c).
D.Solution by MLPThe MLPs have been shown to be universal function approximators [24]. An MLP with D inputs, K outputs, one hidden layer with M nodes yields a K-dimensional output vector y~t→ whose kth component is given by iterated hyperbolic tangents
(4)y~t(k)=tanh(∑l=0Mθl,k(2)tanh(∑j=0Dθj,l(1)xt(j)))
where
(5)z(l)=tanh(∑j=0Dθj,l(1)xt(j))
and for which l = 0, … , M are the outputs of the hidden layer. We use the convention where xt(0) = 1 and z(0) = 1 so that θ0,l(1) and θ0,k(2) represent biases to the transfer function. The generalization to arbitrary numbers of hidden layers is straightforward by nesting additional hyperbolic tangents. The calculation of the vector y~⃗ is called feed-forward propagation.An MLP with nine inputs corresponding to the nine scaffold regions, and ten outputs corresponding to the ten channels is used. Mean values from nine regions of the shear rate map are stored in a vector denoted by xt→ and used as inputs to an MLP whose transfer function is a hyperbolic tangent, has ten outputs corresponding to the ten inlets of the bioreactor, and includes two hidden layers with ten nodes each. The back-propagation with adaptive learning rate and momentum term method [25] was used to update the MLP weights. This technique is suitable in our case since the MLP is trained online one target vector at a time, and since it offers convergence acceleration as compared to the original back-propagation method proposed in [26] by introducing an adaptive learning rate and momentum term.Algorithm 1: Control Algorithm pseudocode1:Initiate MLP inputs2:Evaluate shear stress map for MLP outputs3:Compare to target4:ξb←ξ5:ξ1←ξ6:count=07:Reset8:flag=09:Reset input picking10:Pick11:Randomly pick one of the inputs12:Increase its speed byds13:Evaluate shear stress map for resulting input14:ifξ>ξbthen15:Decrease its speed byds16:Evaluate shear stress map for resulting input17:ifξ>ξbthen18:gotoCheck19:else20:gotoupdate21:else22:update23:ξb←ξ24:count=025:Update MLP26:flag=127:Check28:ifAll inputs pickedthen29:ifflag=1then30:gotoReset31:else32:count=count+133:ifcount>bcountthen34:ξb←ξ35:count=036:Update MLP37:gotoReset38:else39:Perturb40:Add random vector multiple ofdsto input41:Evaluate shear stress map for resultinginput42:ifξ>ξbthen43:gotoPerturb44:else45:ξb←ξ46:count=047:Update MLP48:gotoReset49:else50:gotoPick
E.CFD Shear Rate SimulationMany complex models of porous media have emerged due to advances in the field of CFD. However, they require a detailed characterization of the effective-medium properties of the scaffold in terms of the microscopic properties and remain computationally expensive. Hundreds of simulations are required during the training phase, typically in the range of the number of inputs multiplied by the number of iterations. Consequently, we opted for a simple laminar flow model as an approximation of the complex medium. While the laminar flow model is not recommended for modeling porous media in general, it is used here to save computational time. The porous media was modeled as a distribution of circular obstacles as shown in Fig. 1(g), where the porosity and permeability were chosen similar to the scaffold. This approximation is justified by Reynolds numbers calculation throughout the model using (6) when the maximum flow rate is applied to all channels at once, where they are consistently much less than 1 in the investigated flow range as shown in Fig. 3. Variations from the more accurate and computationally expensive methods that explicitly model the geometry of the microscopic pore space are minimal. Due to the adaptability of the control algorithm, as demonstrated in Figs. 5(d)-(f) and 6 (details in the Section III), any inaccuracies produced by the approximation can be compensated for in the second phase where simulations are replaced with real NMR measurements.(6)ReCell(x,y)=hρvx2(x,y)+vy2(x,y)4μHere, ReCell is the Reynolds number value for a cell in the mesh, h is the average mesh size (along x or y), ρ is the fluid density, vx (x, y) and vy (x, y) are the velocity components at the point (x, y), and μ is the viscosity.Finite-element analysis software COMSOL Multiphysics (COMSOL Inc., Burlington, MA, USA) was used to solve the Navier–Stokes equations for incompressible Newtonian laminar flow with no-slip boundary conditions
(7)ρ(U⋅∇)U=∇⋅[−P+v(∇U+∇U⊺)]−ρGρ∇⋅U=0,U=0at walls.
where U denotes the velocity vector field (m·s−1), P is the pressure (Pa), ρ is density (kg·m3), and ν is the dynamic viscosity (Pa·s). The term ρ · G takes gravity into consideration, where G is the gravitational acceleration (m·s−2). At the inlets, we set U = Uin according to the input speed determined by the algorithm. No viscous stress (P = P0) boundary condition was selected at the outlet. The velocity field is obtained by solving the Navier–Stokes equation. Shear rate ς (s−1) is then calculated as a function of the velocity field using finite difference approximations of ς = (∇U + ∇UT)/2. Shear stress τ (Pa) is obtained by multiplying shear rate values with the dynamic viscosity, i.e., τ = νς.
F.NMR Shear Rate MeasurementThe pulse sequence for the NMR imaging experiment is shown in Fig. 4. A standard spin-echo imaging experiment with slice-select (S.S.), readout (R.O.), and phase-encode (P.E.) gradients was modified to include phase-contrast velocimetry as in [19] and [20]. To generate 2-D images, the sequence is repeated n times while looping the P.E. gradient. Flow-compensation (F.C.) gradients were added along all directions except the P.E. direction. Bipolar, trapezoidal flow-weighting (F.W.) gradients are added along the x-, y-, and z-directions in order to select the gradient first moment M1. In the case of no flow, stationary nuclear spins experience the positive and negative lobes of the bipolar F.W. gradient with the same magnitude. For stationary spins, the phase accumulation from the positive lobe is equal and opposite to the phase accumulation from the negative lobe, resulting in zero net phase accumulation. For moving spins, phase cancellation is incomplete [18] and the residual phase accumulation is proportional to velocity. Once the velocity map is acquired, the corresponding shear rate map can be calculated by taking gradients of the velocity field, as described in the previous section; see also [19]. In this study, velocity measurements represent velocities averaged along the z-direction. Shear rate patterns were controlled along the x- and y-directions.
III.
RESULTS
To demonstrate the method’s ability to generate complex patterns, several different shear-rate maps were produced sequentially. Two examples of spatial patterns are shown in Fig. 5. Fig. 5(a) shows a nontrivial pattern, whereas Fig. 5(d) shows a uniform pattern. CFD simulations of flows within the scaffold of the bioreactor were performed and the results are shown in Fig. 5. The first simulation [see Fig. 5(a)-(c)] was used to test the algorithm’s ability to find inlet flow speeds in the case of a complex shear rate distribution. The pattern consists of a nonlinear gradient featuring low shear rates in the lower right-hand corner juxtaposed against a high shear rate region located in the upper left-hand corner [see Fig. 5(a) and (b)]. Along the path connecting these two corners, the shear rate values range from 0 to 6 s−1. The convergence plot [see Fig. 5(c)] demonstrates that the algorithm converged to a reasonable solution in less than 25 iterations, and found an accurate solution in less than 50 iterations.
The second simulation Fig. 5(d)-(f) was designed to test the algorithm’s ability to adapt to changes over time. The algorithm was required to find inlet flow speeds to generate a uniform shear rate distribution [shown in Fig. 5(d)]. The target shear rate value was originally set to 10 s−1. After the algorithm converged to a solution for the 10 s−1 value, the algorithm was kept running until it reached 100 iterations. At that point, the target shear rate value was changed to 11 s−1 and the convergence speed to the new value was assessed. The convergence plot [see Fig. 5(f)] shows that the algorithm quickly adapts to the new value [see Fig. 5(e)], where only a small number of iterations were required to find a new solution. Note that this ability to quickly adapt to changes allows using crude approximations in training to reduce computational requirements. Additionally, this simulation also illustrates the algorithm’s ability to generate a highly uniform shear rate distribution. It is generally difficult to create a uniform shear rate distribution in a bioreactor with only a single inlet; but with ten inlets excellent results could be obtained. Shear rate values in the scaffold varied between 10 s−1 and 12 s−1, when the target value selected was 11 s−1.
In order to assess the algorithm’s performance in a dynamic environment where scaffold properties are changing over time, an experiment was conducted where the algorithm was trained to achieve a target share rate map for the case where a grid of circular obstacles with a 12.5-μm radius is present. The obstacle radius was then gradually increased to 22.5 μm. The response was assessed by observing the cost function values at the iterations where the radius is increased, and the current shear rate map before the change takes place. This is illustrated in Fig. 6. The results confirm the algorithm’s excellent adaptive abilities. Spikes in cost function values corresponding to instances where structural change occurs are characterized by small amplitudes and widths. The small amplitudes indicate the flexibility of the bioreactor design, where structural changes do not cause drastic changes in the shear rate map. The small widths correspond to the small number of iterations required by the algorithm to adapt and readjust the shear rate map back to the desired target after it had converged in its training phase. These results also validate the use of a simplified CFD model in the training phase, in order to reduce computational cost and training time.
Bioreactor biocompatibility was demonstrated by culturing human aortic endothelial cells (HAECs) in endothelial cell growth media (EGM-2 BulletKit, Lonza CC-3162) flowing at 4 mL/min total flow distributed uniformly at each individual inlet. Two identical scaffolds were seeded with 2.2 × 106 cells and cultured statically at 37 °C and 5% CO2 for 48 h to promote cell attachment to the scaffold. One scaffold was then transferred to the bioreactor while the other remained static in a tissue culture dish as a control. Growth media flowing into the bioreactor was warmed to 37 °C and sparged with a 5% CO2 gas mixture. The scaffolds were cultured for an additional 48 h in their respective conditions before being fixed in a solution containing 2% paraformaldehyde. Following fixation the cells were stained for cell nuclei (DAPI) and cytoskeleton (F-actin with phalloidin). Scaffolds were then imaged with a confocal microscope with 15-μm thick image sections. Imaging results show that cells cultured in the bioreactor survived and proliferated. There were also more cells in the scaffold cultured in the bioreactor compared to static culturing, as evidenced by the number of blue nuclei as well as associated red F-actin staining. Imaging results are presented in Fig. 7. The shear rate map in the collagen scaffold corresponding to the flow rate conditions under which cells were cultured is shown in Fig. 8. This flow pattern was also used with the cellulose scaffold [see Fig. 9(a) and (b)].
Using our method, spatial distributions of shear rate values within the scaffold region can be altered over time to generate arbitrary patterns by merely changing inlet flow speeds. The ten-inlet bioreactor’s ability to dynamically generate versatile and complex mechanical force distributions within a scaffold is demonstrated in Fig. 9. Three different complex shear rate distributions generated sequentially within the same scaffold are shown. To evaluate the effectiveness of the approximations made in training with our CFD model, maps obtained using initial values obtained from simulations are compared with corresponding shear rate maps as measured experimentally using the NMR velocimetry technique [18]-[20].We observe excellent agreement in the generated patterns between theory and experiments. Using NMR feedback, the algorithm can easily adapt to fine tune the moderate range variations due to the adaptive properties demonstrated earlier in Figs. 5(d)-(f) and 6.
IV.
DISCUSSION
Tissue engineering (TE) studies of the effects of shear flows have been hampered by the lack of suitable platforms to control flow fields. Previous attempts at controlling mechanical forces were limited to altering the scaffold structure and bioreactor geometry. Most bioreactors used to date have been designed to operate with a single inlet. Parameters such as perfusion rate, flow, and mechanical stress are typically selected by trial-and-error. Even then, due to many sources of variability, a protocol that works to bring a particular construct to a desired stage may likely fail to work for another construct [27]; thus, the importance of adaptive control with feedback. Given a feedback mechanism, many possible solutions, e.g., single parameter control, or a proportional-integral-derivative controller, may exist for a single-inlet bioreactor. However, a single inlet does not permit fine tuning of the flow field at the microscale, which is an essential element for the study of cellular responses to flow. Bioreactors with multiple inlets, such as the one presented herein, reduce the need for engineering the scaffold material properties, and may alleviate manufacturing complexity while enabling the creation of more accurate and complex flow fields. Spatiotemporal control of mechanical force distributions in scaffolds can be used to dynamically control the bioreactor for applications in TE.
Because the relationship between shear maps and inlet pressure is highly nonlinear, the task of finding a set of inlet pressures to generate a desired flow pattern in a ten-inlet bioreactor is a complex adaptive control problem possessing no known analytical solutions. The adaptive control algorithm presented herein solves the problem numerically. The algorithm demonstrates high efficiency, as it converges to a solution with a small number of iterations. Furthermore, it can learn complex input/output relationships between inlet flow speeds and mechanical force distributions, which gives it the ability to quickly adapt to changes.
V.
CONCLUSION
The concepts presented here are general and could be applied to controlling any other force field, or the flow of substances (e.g., nutrients, gases). Although not demonstrated here, scaffold structure, bioreactor geometry, and inlet positions can easily be included as additional parameters to be optimized along with inlet speeds. An interesting open question would be to verify what shear rate distributions lead to tissue development in a bioreactor scaffold beyond initial stages of cell growth. A possible extension of this study to provide additional control of the flow patterns would be to add multiple outlets to the bioreactor; outlets add more degrees of freedom to the problem where pressure can be released locally.
