1 |
INTRODUCTION
A fiber orientation density (or distribution) function (fODF) gives the volume-weighted angular density of axon orientations for individual white matter imaging voxels. It can be estimated from diffusion MRI (dMRI) data with one of several methods.1,2 These include constrained spherical deconvolution (CSD),3,4 which is perhaps the most commonly employed, and the more recently proposed fiber ball imaging (FBI).5,6 Both techniques are used for constructing white matter fiber tractography and for calculating compartment-specific microstructural parameters.5–11
A shortcoming of CSD and FBI, as well as some other approaches, is that estimated fODFs may take on negative values in some directions due to signal noise and imaging artifacts.3,4,6,12,13 Negative values can also be caused by truncation of a spherical harmonic expansion for an fODF to a finite degree, as is typically done in both CSD and FBI, which leads to Gibbs ringing.6,13 Such negative values are, of course, unphysical and may hamper certain types of applications. For example, the fODF is interpreted as a probability density in some fiber tracking algorithms,7,14 in which case negative values are problematic. Negative fODF values might also adversely affect the accuracy of estimates for microstructural parameters.
The most straightforward method of rectifying an fODF is to replace all negative values with zeros. However, this is not optimal in the sense of minimizing the mean square difference between the original and rectified fODFs. In this paper, an analytic expression is given for an optimally rectified fODF that does minimize the mean square difference. This expression has one free parameter that is fixed by a normalization condition. An optimally rectified fODF may have fewer peaks than the original fODF, but the directions of any surviving peaks will be unaltered. In addition, the heights of any peaks eliminated by rectification will always be less than the heights (before rectification) of any surviving peaks.
We present here the theory for optimized fODF rectification and illustrate this method with several examples. We consider first a simple mathematical model in which negative fODF values are generated by Gibbs ringing. Then we apply the method to both CSD and FBI fODFs estimated using dMRI data obtained from 3 healthy volunteers for a b-value of 6000 s/mm2. We also show how rectification affects estimates of the fractional anisotropy axonal (FAA) and the number of detected fODF peaks. Results for the alternative rectification approach of simply setting the negative values to zero, which we call step function rectification, are provided for the sake of comparison.
2 |
THEORY
2.1 |Definition of optimized rectificationLet us represent an original (approximate) fODF by a function F(n)n where n is a unit direction vector. Without loss of generality, we assume the antipodal symmetry F(−n) = F(n) and the normalization condition
(1)∫dΩnF(n)=1
where the integral is over all directions. We suppose that F(n) may take on negative values in some directions and that we would like to find a rectified fODF, F^(n), with the following properties
(2)F^(n)≥0,(3)F^(−n)=F^(n).
and
(4)∫dΩnF^(n)=1.
In addition, the rectified fODF should be chosen to minimize the cost function
(5)C≡∫dΩn[F^(n)−F(n)]2
in order to be as close to the original fODF as possible in the mean square sense. It should be emphasized that normalizing the fODFs so that their integral over all directions is unity, rather than a different constant, is just a convenient choice, and our method generalizes trivially to other normalizations provided they are preserved by the rectification procedure. A feature of the cost function of Eq. 5 is that it depends both on the positive and negative values of the original fODF. This can be an advantage, as we shall see, for taking into account fluctuations of the fODF about zero, as may arise from noise and imaging artifacts.
2.2 |General solutionThe central result of this paper is that the optimized fODF, as defined above, is given by
(6)F^(n)=12[|F(n)−ε|+F(n)−ε].
That Eq. 6 obeys Eq. 2 follows directly from the fact
(7)|F(n)−ε|≥ε−F(n),
and Eq. 3 holds as a consequence of the antipodal symmetry for F(n). In order for F^(n) to be normalized in accordance with Eq. 4, one must choose the parameter ε so that it satisfies the equation
(8)12∫dΩn[|F(n)−ε|+F(n)−ε]=1.
This condition can also be expressed as
(9)∫dΩn[|F(n)−ε|−F(n)−ε]=0.
The solution to Eq. 8 or Eq. 9 is unique and is always in the range 0 ≤ ε < Fmax, where Fmax is the maximum value for F(n) over all directions. The solution ε = 0 only occurs if F(n) has no negative values in which case the original and rectified fODFs are identical.Mathematical proofs that the optimized fODF has the form of Eq. 6 and that there is a unique solution for ε are sketched in the Appendix. We also show in the Appendix that any direction in which the optimized fODF has a local maximum (i.e., a peak direction) is also a local maximum of the original fODF. It should be noted that if F(n) > ε then we simply have F^(n)=F(n)−ε; otherwise Eq. 6 sets the optimized fODF to zero. In this way, ε acts as a natural threshold.
2.3 |Step function rectificationA straightforward alternative to the optimized rectification procedure described above is to set all the negative values to zero and then rescale the fODF so the normalization is unchanged. This procedure is expressed mathematically as
(10)FS(n)=F(n)H[F(n)]/∫dΩnF(n)H[F(n)]
where H(x) is the Heaviside step function. We call Fs(n) the “step function” fODF. This approach is the most straightforward procedure possible and is included here as a reference for comparison with the optimized fODF of Eq. 6. The step function fODF satisfies the same properties of Eqs. 2–4, but does not minimize the cost function of Eq. 5 except for trivial case of ε = 0.
2.4 |Mathematical model with Gibbs ringingAs an illustration of optimized fODF rectification, we use a simple mathematical model where the exact fODF is given by
(11)F(n)=14π(1−cosθc)[H(θc−θ)+H(θc+θ−π)],
with θ being the polar angle for n and θc a cut-off angle. This fODF is zero for θc < θ < π − θc, and it has a constant positive value for 0 ≤ θ < θc and for π − θc ≤ θ < π. Thus the fODF is axially symmetric with respect to the line defined by θ = 0.The spherical harmonic expansion for the fODF of Eq. 11 is
(12)F(n)=∑l=0∞∑m=−2l2lc2lmY2lm(θ,φ)
where φ is the azimuthal angle for n, Ylm(θ,φ) are the spherical harmonics of degree l and order m, and clm are the expansion coefficients. Only even degree harmonics are needed because of the antipodal symmetry for F(n). The expansion coefficients are given explicitly by
(13)c00=14π
and
(14)c2lm=δ0m(1−cos θc)4π(4l+1)⋅[P2l−1(cos θc)−P2l+1(cos θc)],   if l>0,
where Pl(x) is a Legendre polynomial of degree l and δmn is the Kronecker delta. By combining Eqs. 12–14, one finds that
(15)F(n)=14π+14π(1−cos θc)∑l=1∞[P2l−1(cos θc)−P2l+1(cos θc)]P2l(cos θ).If the expansion of Eq. 15 is truncated at a finite degree, as is often done with experimentally determined fODFs, one obtains the approximation
(16)F(n)≈14π+14π(1−cos θc)∑l=1N[P2l−1(cos θc)−P2l+1(cos θc)]P2l(cos θ).
where lmax ≡ 2N is the maximum degree for the retained spherical harmonics. Although the exact fODF has no negative values, the approximation of Eq. 16 will typically take on negative values in some directions due to Gibbs ringing.15
3 |
METHODS
3.1 |Mathematical modelFor the mathematical model with Gibbs ringing, the original fODF was taken to be the approximation of Eq. 16, while the optimized fODF was determined from Eq. 6 and the step function fODF was determined from Eq. 10. Values for the parameter ε were found by solving Eq. 9 using the bisection method. The integrals needed to evaluate Eqs. 9 and 10 were all determined analytically. Three different cut-off angles were considered, θc = π/12, π/6, and π/4, and the maximum degree was varied from lmax = 2 to lmax =12. To assess the accuracy of the original, optimized, and step function fODFs, the mean square error (MSE) was defined by
(17)MSE≡14π∫dΩn[F(n)−Fexact (n)]2,
where Fexact is the exact fODF of Eq. 11 and F is either the approximation of Eq. 16, the corresponding optimized fODF found from Eq. 6, or the corresponding step function fODF found from Eq. 10.
3.2 |ImagingThree healthy adult volunteers (ages 26–33 yr) were scanned on a 3 T Prismafit MRI system (Siemens Healthineers, Erlangen, Germany) using a 32-channel head coil under a protocol approved by the institutional review board of the Medical University of South Carolina. For each subject, single-shot full Fourier dMRI data were acquired using a twice-refocused dMRI pulse sequence to reduce eddy current artifacts.16 The following imaging parameters were employed for all 3 subjects: TE = 110 ms, TR = 5300 ms, FOV = 222 × 222 mm2, acquisition matrix = 74 × 74, slice thickness = 3 mm, number of slices = 42, phase encoding acceleration factor (GRAPPA) = 2, slice acceleration factor = 2, coil combine mode = adaptive combine, bandwidth = 1648 Hz/px, number of diffusion encoding directions = 128, and b-values = 1000, 2000, and 6000 s/mm2. For 2 subjects, an additional 66 images were obtained with the b-value set to 0 (b0 images) and all other imaging parameters unchanged, while 16 b0 images were acquired for the third subject. The total imaging time was 35–40 min per subject.
3.3 |Data analysisThe preprocessing of the diffusion weighted imaging data included denoising,17 Gibb’s ringing artifact reduction,18 and Rician noise bias correction19 utilizing the noise map generated by the denoising algorithm. Following these procedures, all the diffusion weighted images for each subject were subsequently co-registered using a rigid-body transformation.20 A conventional diffusional kurtosis imaging analysis was applied to the data with b-values of 0, 1000 and 2000 s/mm2 in order to generate parametric maps for the mean diffusivity and mean kurtosis.21 White matter was then defined as all voxels within the cerebrum having mean diffusivity less than 1.5 μm2/ms and mean kurtosis greater than 1.22Both the CSD and FBI fODFs were calculated from the data with a b-value of 6000 s/mm2. For CSD, the fODFs were generated by MRTrix3 (http://www.mrtrix.org/) using the ‘fa’ algorithm.23 For FBI, the fODFs were obtained using the inverse generalized Funk transform with intra-axonal diffusivity upper bound parameter D0 set to 3.0 μm2/ms.5,6 With both techniques, the fODFs were represented in terms of spherical harmonics including all even degrees up to 8. Optimized fODFs were found from Eq. 6 where the parameter ε was determined by solving Eq. 9 with the bisection method. Step function fODFs were obtained from Eq. 10. The integrals in Eqs. 9 and 10 were performed numerically using 5286 uniformly distributed directions on a half-sphere, which is sufficient because of antipodal symmetry. This number of directions corresponds to an angular resolution of about 2°, which is small in comparison to the angular scale over which the estimated fODFs vary significantly.The FAA for all fODFs was determined using the formula10(18) FAA =3∑m=−22|c2m|25|c00|2+2∑m=−22|c2m|2.
In order to calculate the FAA from Eq. 18, the optimized and step function fODFs were expanded in spherical harmonics up to order 14, after being constructed via Eq. 6 or Eq. 10, even though only the coefficients for l = 0 and 2 were actually needed. In determining the expansion coefficients, the same 5286 uniformly distributed directions were used as with the aforesaid numerical integrals. But for all other calculations, the exact formulae of Eqs. 6 and 10 were employed. The FAA represents the fractional anisotropy for all intra-axonal water within each voxel treated as a single compartment. In white matter, it tends to be larger than the conventional fractional anisotropy since the less restricted extra-axonal water pool is excluded. Just as for the conventional fractional anisotropy, the FAA tends to be higher in single fiber direction voxels and lower in voxels with fiber crossings.The number of fODF peaks (i.e., maxima) was obtained by applying the peak detection algorithm of Glenn and coworkers.24 Pairs of peaks related by antipodal reflection symmetry were counted as a single peak. Peaks with amplitudes below 0.01 were omitted in these counts as being insignificant. This is a much lower peak threshold than is typically employed in the context of fiber tractography.4,7 We chose a small peak threshold in order to highlight the effect of rectification on the total number of peaks.
3 |
RESULTS
3.1 |Mathematical modelExamples of the exact and original fODFs for the mathematical model of Eq. 11 are shown in Figure 1 with θc = π/6 = 30° and maximum degrees of lmax = 4, 6, 8, 10. Also shown in Figure 1 are the corresponding rectified fODFs obtained from Eqs. 6 and 10. For optimized rectification, the values for ε calculated from Eq. 9 are 0.02967, 0.01183, 0.02395 and 0.01969 for lmax = 4, 6, 8, 10, respectively. Observe that the rectified fODFs not only eliminate all negative values, but also reduce the size of the smaller positive peaks generated by Gibbs ringing. Also notice that the original and rectified fODFs have identical peak directions. Optimized rectification suppresses the small peaks more strongly than does step function rectification.The MSEs for the three approximations are given by Figure 2 for θc = 15°, 30°, and 45° and maximum degrees of lmax = 2, 4, 6, 8, 10, and 12. In each case, the optimized fODF has a smaller MSE than the original fODF, although in some cases the difference is slight. The step function fODF, in contrast, has a higher MSE than the original fODF in several cases, as is particularly apparent for θc = 15°. The MSE decreases with increasing θc since a broader fODF leads to smaller Gibbs ringing artifacts.
3.2 |Human dataContour plots of original, optimized, and step function fODFs for 3 different voxels from a single subject are given by Figures 3 and 4. In Figure 3, the original fODF was calculated using CSD, and the optimized fODFs had (from top to bottom) ε = 0.0975, 0.1475, and 0.1315. In Figure 4, the original fODF was calculated using FBI, and the optimized fODFs had ε = 0.0090, 0.0112, and 0.0091. The three-dimensional glyphs of these same fODFs are depicted in Figures 5 and 6. The original fODFs all have significant portions in which they take on unphysical negative values. These are entirely eliminated by rectification. The main qualitative difference between optimized and step function rectification is that optimized rectification alters the heights of the larger peaks less but suppresses the smaller peaks more strongly. In addition, optimized rectification eliminates some small peaks while step function rectification does not. These effects are more conspicuous for CSD since the original CSD fODFs have more pronounced negative regions.Figure 7 shows the distribution of original and rectified FAA values of all white matter voxels for the pooled data from all 3 subjects. With CSD, the average FAA is 0.72 ± 0.15 for the original fODF, 0.69 ± 0.16 for the optimized fODF, and 0.59 ± 0.13 for the step function fODF. With FBI, the average FAA is 0.59 ± 0.14 for the original fODF, 0.57 ± 0.14 for the optimized fODF, and 0.55 ± 0.13 for the step function fODF. The original CSD fODFs have unphysical FAA values exceeding 1 in 1.25% of their voxels, which is only possible when the fODF takes on negative values.6 After rectification, all FAA values are guaranteed to be in the physical range between 0 and 1. This is true for both optimized and step function rectification.Distributions of the number of peaks identified in the original and rectified fODFs for the pooled white matter voxels are plotted in Figure 8. Step function rectification has no effect on the number of peaks since all positive regions are simply rescaled according to Eq. 10. Optimized rectification decreases the average number of peaks from 8.57 ± 1.41 to 7.52 ± 1.87 with CSD and from 8.11 ± 1.63 to 8.10 ± 1.62 with FBI. Therefore, optimized rectification does not alter the number of FBI peaks for most voxels of our dataset. This reflects the fact that the magnitude of the negative fODF values for FBI tends to be relatively small as exemplified in Figure 4.
4 |
DISCUSSION
The remarkable capability of dMRI to estimate fODFs is useful both for fiber tractography and for intra-voxel tissue modeling estimation of microstructural parameters. Two of the simplest methods of constructing fODFs are CSD and FBI.3–6 However, both CSD and FBI are prone to generating fODFs that are negative in some directions. Here we have proposed a strategy for rectifying such fODFs in order to eliminate all negative values. This technique is optimal in the sense that the mean square difference between the original and rectified fODFs is minimized. In addition, the optimized rectification does not alter the directions of all peaks that are not removed and is thus unlikely to have significant deleterious effects for fiber tractography.
The numerical implementation of our method requires that a solution of Eq. 9 be found for the parameter ε, which can be easily achieved using a bisection algorithm. The rectified fODF is then directly given by Eq. 6. Thus adding optimized rectification as a data processing step should be straightforward regardless of the type of fODF or its method of calculation, and the computational burden would be minimal.
As illustrations, we have applied optimized rectification both to a mathematical model in which negative fODF values arise as a consequence of Gibbs ringing and to in vivo data from healthy volunteers. For the mathematical model, where we have a ground truth in terms of an exact fODF, we find that optimized rectification of an approximate fODF, obtained by truncating a spherical harmonic expansion, consistently leads to a reduction in MSE along with elimination of all negative values. For human data, we have demonstrated optimized rectification for both CSD and FBI fODFs. Rectification was seen to reduce the FAA and the total number of detected peaks with these effects being more substantial for CSD. However, the major peaks are unchanged in direction, and their shapes are preserved albeit with a small reduction in amplitude.
There are at least two advantages to applying optimized rectification to fODFs. First, the reliability of small peaks that it suppresses is dubious, and so optimized rectification likely results in more accurate fODFs. This was demonstrated explicitly for the mathematical model. Although we have no ground truth to confirm an improved accuracy for in vivo data, the small peaks that it suppresses are prone to being altered by signal noise and imaging artifacts. Thus it is reasonable to suppose that suppression of such features is often beneficial. Second, some versions of fiber tracking interpret fODFs as probability density functions which makes negative values problematic. In view of these two benefits of optimized rectification and of the minimal computational costs in applying it, we recommend this be considered for any estimated fODF that suffers from negative values.
As a comparison, we have also considered step function rectification as defined by Eq. 10. This is the most basic rectification method and shares with our proposed optimized rectification the property of preserving the peak locations. However, step function rectification does not minimize the mean square difference relative to the original fODF nor does it eliminate any of the smaller peaks. Since the negative parts of the original fODF may also encode useful information, as for example with Gibbs ringing where negative values offset positive values in regions of an approximate fODF that should ideally be zero or close to zero, minimizing the mean square difference can result in more accurate rectification than the step function approach that essentially neglects the negative values. We have demonstrated this explicitly for the mathematical model. In particular, the results of Figure 2 show that step function rectification often reduces the accuracy of the fODF while optimized rectification improves it. For the in vivo human data, we find that optimized rectification alters the heights of the large peaks less than step function rectification at the same time that it more strongly suppresses small peaks. Both methods reduce the FAA, with the step function rectification actually having a bigger effect, illustrating how rectification can substantially impact an important fODF property.
Although the purpose of this paper is not to compare CSD and FBI fODFs, it is worth noting that these two techniques generate remarkably similar fODFs in spite of being based on rather disparate mathematical algorithms. In particular, they consistently identify major peaks with nearly the same directions. However, the CSD fODFs tend to be sharper, as reflected in their larger FAA values, and also to have more extensive regions with negative values. In addition, the two fODFs do differ significantly in their fine structure suggesting that some of this may be artifactual in origin. Further studies that explore the similarities and differences between CSD and FBI fODFs would be of interest. An alternative fODF estimation method that does not generate negative values is Richardson-Lucy spherical deconvolution.25 Although this approach obviates the need for rectification, it is, by the same token, more computationally demanding than either CSD or FBI.13 A comparison of fODFs obtained with Richardson-Lucy spherical deconvolution with rectified CSD and FBI fODFs would also be valuable.
5 |
CONCLUSIONS
We have shown how to rectify fODFs in order to eliminate unphysical negative values while minimizing the mean square difference between the rectified and original forms. The method is simple to implement and thus provides a practical method for generating more physically plausible fODFs. It may be useful in conjunction with both CSD and FBI, as well as other related approaches for estimating fODFs.
